@page "/cadastros/transportadoras/nova"
@page "/cadastros/transportadoras/{Id:guid}"
@inject HttpClient Http
@inject NavigationManager Navigation

<MudPaper Class="p-4 mx-auto mt-4" Style="max-width: 600px;">
    <MudText Typo="Typo.h6" Class="mb-4">
        @_editando ? "Editar Transportadora" : "Nova Transportadora"
    </MudText>

    <MudForm @ref="_form">
        <MudTextField Label="Nome" @bind-Value="_transportadora.Nome" Required="true" For="@(() => _transportadora.Nome)" />
        <MudTextField Label="CNPJ" @bind-Value="_transportadora.Cnpj" />
        <MudTextField Label="IE" @bind-Value="_transportadora.Ie" />
        <MudTextField Label="Email" @bind-Value="_transportadora.Email" />
        <MudTextField Label="Telefone" @bind-Value="_transportadora.Telefone" />
        <MudTextField Label="Endereço" @bind-Value="_transportadora.Endereco" />
        <MudTextField Label="Cidade" @bind-Value="_transportadora.Cidade" />
        <MudTextField Label="UF" @bind-Value="_transportadora.Uf" />

        <MudStack Direction="Row" Spacing="2" Class="mt-4">
            <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="Salvar">
                Salvar
            </MudButton>
            <MudButton Variant="Variant.Outlined" Color="Color.Secondary" OnClick="Voltar">
                Cancelar
            </MudButton>
        </MudStack>
    </MudForm>
</MudPaper>

@code {
    [Parameter]
    public Guid? Id { get; set; }

    private Transportadora _transportadora = new();
    private MudForm _form = null!;
    private bool _editando => Id.HasValue;

    protected override async Task OnInitializedAsync()
    {
        if (_editando)
        {
            var result = await Http.GetFromJsonAsync<Transportadora>($"api/transportadora/{Id}");
            if (result is not null)
                _transportadora = result;
        }
    }

    private async Task Salvar()
    {
        await _form.Validate();

        if (!_form.IsValid)
            return;

        if (_editando)
            await Http.PutAsJsonAsync("api/transportadora", _transportadora);
        else
            await Http.PostAsJsonAsync("api/transportadora", _transportadora);

        Navigation.NavigateTo("/cadastros/transportadoras");
    }

    private void Voltar()
    {
        Navigation.NavigateTo("/cadastros/transportadoras");
    }
}
